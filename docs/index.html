<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes">
  <title>영화알림</title>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script data-ad-client="ca-pub-8598336719433043" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    var response
    function start() {
      // 2. Initialize the JavaScript client library.
      gapi.client.init({
        'apiKey': 'AIzaSyCTNqqcP0PcpbyNkyvUxgrtRvnqXqB7U4U',
        // clientId and scope are optional if auth is not required.
        //'clientId': '601826383195-jshjvb343kq9m4d7im9mqgqiu78b75ad.apps.googleusercontent.com',
        //'scope': 'profile',
      }).then(function() {
        // 3. Initialize and make the API request.
        return gapi.client.request({
          'path': 'https://sheets.googleapis.com/v4/spreadsheets/1PXoXNt12WjW-2nyYh1lzZu35Vm9lucagRon9N9dJKJU/values/시트1',
        })
      }).then(function(res) {
      	response = res.result
        console.log(res.result)
      }, function(reason) {
        console.log('Error: ' + reason.result.error.message)
      })
    }
    // 1. Load the JavaScript client library.
    gapi.load('client', start)
  </script>
</head>

<body>
<h1>영화알림 채널에 오신것을 환영합니다.</h1>
<p>롯데시네마, CGV, 메가박스의 1+1 알림을 제공받으세요.</p>
텔레그램 채널: <a href="https://t.me/cinema1p1">https://t.me/cinema1p1</a>
<br>
<br>
구매링크: <a id="url" href="#">잠시만 기다려주세요.</a>
<script>
function getQuery() {
  var queries = {}
    location.search.substr(1)
      .split('&')
      .forEach(function (param) {
        var data = param.split('=')
        queries[data[0]] = decodeURIComponent(data[1])
      })
    return queries
}
function setInfo(googleSheet) {
  var $ele = document.getElementById('url')
  // 서비스명
  $ele.innerText = googleSheet[2]
  // 링크 입력
  $ele.href = decodeURIComponent(googleSheet[6])
}

var queries = getQuery()

var i = setInterval(function() {
  if (!response) return
  if (!queries.key) return setInfo(response[response.length - 1])
  setInfo(response[response.findIndex(function(googleSheet) {
    return googleSheet[1] === queries.key
  })])
  clearInterval(i)
}, 200)

</script>

</body>
</html>
